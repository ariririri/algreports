# ABC126-F
## 問題
以下の条件を満たす、長さ $2^{M+1}$の数列$a = \{a_1, a_2, ..., a_{2^{M+1}}\}$を、存在するならば1つ構築してください。

- $a$は0以上$2^M$未満の整数をそれぞれちょうど 2 つずつ含む。
- $a_i=a_j$を満たす任意の$i, j (i<j)$ について、$a_i \ xor a_{i+1} \ xor \ldots \ xor \ a_j=K$ である。

## 考察
まず$a_i \ xor a_{i+1} \ xor \ldots \ xor \ a_j$が取りえる値の範囲を考える.
排他的論理和はbitが一度も1になっていない桁は必ず0になる.
全ての$a_i$に対し,$M+1$以上のビットは$0$となるので,$a_i \ xor a_{i+1} \ xor \ldots \ xor \ a_j \le 2^{M}-1$となる.
ここからすぐわかるように,$K \ge 2^M$の時,該当する数列は存在しない.

また,$M =0$の時は$0,0$という列しか存在しないため,
- $K=0$では条件を満たす.
- $K \ge 1$の時は条件を満たさない.
がわかる.

以降では$M \ge 1, 0 \le K \le 2^{M}-1$とし、実際に合計が$K$になるような場合がいつかを考えていく,
例えば$n= a_i = a_j \neq K$の時,
- 任意の$m \neq K$に対し,$\#  \{ x \in  \{i, i+1, \ldots, j\} \mid a_x = m\}$が偶数
- $\#  \{ x \in  \{i, i+1, \ldots, j\} \mid a_x = K\}$が奇数

であれば$a_i \ xor a_{i+1} \ xor \ldots \ xor \ a_j=K$となる.
これは$xor$が順序によらないことから,$\{a_i, a_{i+1}, \ldots a_j\}$を$K$を最初に置き,残りで数値の低い順に並べると
$K xor \ x_1 \  xor \ x_1 \ xor \ldots x_l xor x_l$となり,
- $x_k \ xor x_k = 0$
- $K \ xor 0 = K$

からわかる.

また$a_i = a_j = K$の時,$S_{ij}:= a_i \ xor a_{i+1} \ xor \ldots \ xor \ a_j$とする.
$a_i$から$a_j$で$k$番目のビットが$1$である数が$\alpha_k$個だった場合,$S_{ij}$の$K$ビット目は
$\frac{1}{2}(1 - (-1)^{\alpha_k})$となる.
よって
$$
S_{ij} = \sum_{k=1}^{M}2^{k-2}(1 - (-1)^{\alpha_k})
$$
となる.
$0$から$2^{M}-1$までの排他的論理和を取った数を$S$とすると,
$\alpha_k = 2^{M -1}$になるので,$M > 1$の時$S = 0$となる.
よって,もし$a_i, a_j$の間に$K$以外の全て数がちょうど一つ存在する場合,条件を満たす.

よって,
- $n= a_i = a_j \neq K$の時,
  - 任意の$m \neq K$に対し,$\#  \{ x \in  \{i, i+1, \ldots, j\} \mid a_x = m\}$が偶数
  - $\#  \{ x \in  \{i, i+1, \ldots, j\} \mid a_x = K\}$が奇数
- $a_i = a_j = K$の時,
  $a_i, a_j$の間に$K$以外の全て数がちょうど一つ存在する
これを満たす列が構成できれば,存在を示せる.

$M >1$の時,実際にこれが構成できることを示す.
具体的には
$$
K,0,1,2, \ldots K-1,K+1,\ldots,2^{M}-1, K, 2^{M}-1, 2^{M}-2, \ldots 0
$$
とすればよい.

確かに$K$以外の同じ数の間には$K$以外の数が2回 or 0回あり,$K$が一回存在する.
また$K$同士の間には$K$以外の全て数がちょうど一つ存在するので,条件を満たす.

$M=1$の時,取り合えるのは$0, 1$であるが,$0,1$の並べ方には以下の6通りしかなく,
- $0,0,1,1$
- $0,1,0,1$
- $0,1,1,0$
- $1,0,0,1$
- $1,0,1,0$
- $1,1,0,0$

$1$同士の間には$0$しか入りようがないため,$M=1$は$K=0$のみ可能となる.


これをまとめると
- $M = 0$の時,$K=0$のみ可能: 例$0,0$
- $M = 1$の時,$K=0$のみ可能: 例$0, 0, 1,1$
- $M \ge 2$の時,$K \le 2^{M}-1$なら以下で可能:
   $K,0,1,2, \ldots K-1,K+1,\ldots,2^{M}-1, K, 2^{M}-1, 2^{M}-2, \ldots 0$

である.

